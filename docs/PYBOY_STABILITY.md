# PyBoyç¨³å®šæ€§æ”¹è¿›è¯´æ˜

## é—®é¢˜åˆ†æ

### PyBoyçª—å£æ˜¾ç¤º"æœªå“åº”"çš„åŸå› 

1. **ä¸»çº¿ç¨‹é˜»å¡**
   - AIå†³ç­–è°ƒç”¨APIéœ€è¦6-8ç§’ç­‰å¾…
   - åœ¨ç­‰å¾…æœŸé—´ï¼Œä¸»çº¿ç¨‹è¢«å®Œå…¨é˜»å¡
   - PyBoyçª—å£æ— æ³•å¤„ç†Windowsæ¶ˆæ¯ï¼ˆé¼ æ ‡ã€é”®ç›˜ã€é‡ç»˜äº‹ä»¶ï¼‰
   - Windowsæ“ä½œç³»ç»Ÿæ£€æµ‹åˆ°çª—å£é•¿æ—¶é—´æ— å“åº”ï¼Œæ˜¾ç¤º"æœªå“åº”"è­¦å‘Š

2. **ç¼ºå°‘äº‹ä»¶å¾ªç¯**
   - GUIåº”ç”¨ç¨‹åºéœ€è¦å®šæœŸå¤„ç†çª—å£äº‹ä»¶
   - PyBoyçª—å£éœ€è¦å“åº”é‡ç»˜ã€ç§»åŠ¨ã€å…³é—­ç­‰æ“ä½œ
   - å½“å‰ä»£ç åªåœ¨å†³ç­–åè°ƒç”¨ä¸€æ¬¡`tick()`
   - åœ¨ç­‰å¾…AIå“åº”çš„6-8ç§’å†…ï¼Œçª—å£å®Œå…¨å†»ç»“

3. **CPUå’Œèµ„æºç«äº‰**
   - `speed: 0`ï¼ˆæ— é™é€Ÿåº¦ï¼‰å¯¼è‡´CPUå ç”¨è¿‡é«˜
   - å¯è§†åŒ–WebæœåŠ¡å™¨ï¼ˆFlask + SocketIOï¼‰ä¹Ÿæ¶ˆè€—èµ„æº
   - PyBoyçª—å£å’ŒWebæœåŠ¡å™¨äº‰å¤ºç³»ç»Ÿèµ„æº

## è§£å†³æ–¹æ¡ˆ

æˆ‘å·²å®æ–½ä»¥ä¸‹æ”¹è¿›æ¥å½»åº•è§£å†³PyBoyç¨³å®šæ€§é—®é¢˜ï¼š

### 1. âœ… å¼‚æ­¥AIå†³ç­–ç³»ç»Ÿ (AsyncDecisionMaker)

**æ–‡ä»¶**: `src/agents/async_decision.py`

**åŸç†**:
- åˆ›å»ºç‹¬ç«‹çš„å·¥ä½œçº¿ç¨‹å¤„ç†AIå†³ç­–
- ä¸»çº¿ç¨‹åœ¨ç­‰å¾…æœŸé—´ç»§ç»­tick PyBoy
- é€šè¿‡é˜Ÿåˆ—(Queue)å®ç°çº¿ç¨‹é—´é€šä¿¡
- å®Œå…¨éé˜»å¡ï¼ŒPyBoyçª—å£å§‹ç»ˆå“åº”

**å·¥ä½œæµç¨‹**:
```
ä¸»çº¿ç¨‹                     å·¥ä½œçº¿ç¨‹
  |                          |
  |--å‘é€å†³ç­–è¯·æ±‚-->         |
  |                          |--è°ƒç”¨AI API
  |--tick PyBoy (æ¯100ms)    |   (6-8ç§’)
  |--tick PyBoy              |
  |--tick PyBoy              |--å†³ç­–å®Œæˆ
  |<---è·å–å†³ç­–ç»“æœ----------|
  |
  |--æ‰§è¡Œè¡ŒåŠ¨
```

**å…³é”®ä»£ç ** (`main.py`):
```python
def _get_ai_decision_responsive(self, current_state: dict, state_text: str) -> dict:
    # å¼‚æ­¥è¯·æ±‚AIå†³ç­–
    self.async_ai.request_decision(current_state, state_text)

    # ç­‰å¾…å†³ç­–æ—¶ä¿æŒPyBoyå“åº”
    while time.time() - start_time < max_wait_time:
        # æ£€æŸ¥æ˜¯å¦å®Œæˆ
        decision = self.async_ai.get_decision(timeout=0.0)
        if decision:
            return decision

        # æ¯100ms tick PyBoyä¿æŒçª—å£å“åº”
        self.emulator.tick(6)  # ~100ms at 60fps
        time.sleep(0.05)
```

**æ•ˆæœ**:
- âœ… AIå†³ç­–æ—¶PyBoyçª—å£ä¸ä¼šå†»ç»“
- âœ… çª—å£å¯ä»¥ç§»åŠ¨ã€æœ€å°åŒ–ã€å…³é—­
- âœ… æ¸¸æˆç”»é¢æŒç»­æ›´æ–°
- âœ… ä¸å†æ˜¾ç¤º"æœªå“åº”"

### 2. âœ… Headlessæ¨¡å¼ï¼ˆæ¨èï¼‰

**é…ç½®**: `config.yaml`
```yaml
game:
  headless: true  # ä¸æ˜¾ç¤ºPyBoyçª—å£
```

**ä¼˜åŠ¿**:
- å®Œå…¨é¿å…çª—å£å“åº”é—®é¢˜
- èŠ‚çœç³»ç»Ÿèµ„æºï¼ˆæ— å›¾å½¢æ¸²æŸ“ï¼‰
- é€šè¿‡Webä»ªè¡¨æ¿è§‚çœ‹æ¸¸æˆ
- æ›´ç¨³å®šã€æ›´é«˜æ•ˆ

**ä½¿ç”¨æ–¹å¼**:
- PyBoyåœ¨åå°è¿è¡Œï¼Œæ²¡æœ‰çª—å£
- æ‰“å¼€ http://localhost:5000 æŸ¥çœ‹å®æ—¶æ¸¸æˆç”»é¢
- Webä»ªè¡¨æ¿æ˜¾ç¤ºé«˜è´¨é‡æˆªå›¾å’ŒAIå†³ç­–

### 3. âœ… ä¼˜åŒ–çš„Tické¢‘ç‡

**æ”¹è¿›**:
```python
# åœ¨ç­‰å¾…AIæ—¶ï¼šæ¯100ms tickä¸€æ¬¡
self.emulator.tick(6)  # ~100ms at 60fps

# å†³ç­–åï¼šæ­£å¸¸tick
self.emulator.tick(10)
```

**æ•ˆæœ**:
- ä¿æŒPyBoyäº‹ä»¶å¾ªç¯æ´»è·ƒ
- å¹³è¡¡CPUä½¿ç”¨å’Œå“åº”æ€§
- é¿å…èµ„æºæµªè´¹

### 4. âœ… é…ç½®é€‰é¡¹

**æ–°å¢é…ç½®** (`config.yaml`):
```yaml
performance:
  async_decisions: true  # å¯ç”¨å¼‚æ­¥AIå†³ç­–ï¼ˆæ¨èï¼‰

game:
  headless: true  # ä½¿ç”¨headlessæ¨¡å¼ï¼ˆæ¨èï¼‰
```

**çµæ´»é…ç½®**:
- `async_decisions: false` - å›é€€åˆ°åŒæ­¥æ¨¡å¼ï¼ˆä¼šå¡é¡¿ï¼‰
- `headless: false` - æ˜¾ç¤ºPyBoyçª—å£ï¼ˆé…åˆasync_decisionsä½¿ç”¨ï¼‰

## é…ç½®æ¨è

### ğŸŒŸ æœ€ä½³é…ç½®ï¼ˆæ¨èï¼‰

```yaml
game:
  headless: true  # ä¸æ˜¾ç¤ºPyBoyçª—å£
  speed: 0        # æ— é™é€Ÿåº¦

performance:
  async_decisions: true  # å¼‚æ­¥AIå†³ç­–

visualization:
  enabled: true   # å¯ç”¨Webä»ªè¡¨æ¿
  port: 5000
```

**ä¼˜åŠ¿**:
- âœ… é›¶å“åº”é—®é¢˜
- âœ… æœ€é«˜æ€§èƒ½
- âœ… å®Œæ•´å¯è§†åŒ–
- âœ… æœ€ç¨³å®š

### æ–¹æ¡ˆäºŒï¼šæ˜¾ç¤ºPyBoyçª—å£

```yaml
game:
  headless: false  # æ˜¾ç¤ºPyBoyçª—å£
  speed: 1         # æ­£å¸¸é€Ÿåº¦

performance:
  async_decisions: true  # å¿…é¡»å¯ç”¨å¼‚æ­¥
```

**è¯´æ˜**:
- âœ… å¯ä»¥çœ‹åˆ°åŸç”ŸPyBoyçª—å£
- âœ… çª—å£ä¿æŒå“åº”
- âš ï¸  éœ€è¦å¼‚æ­¥å†³ç­–æ”¯æŒ
- âš ï¸  å»ºè®®ä½¿ç”¨æ­£å¸¸é€Ÿåº¦ï¼ˆspeed: 1ï¼‰

### ä¸æ¨èï¼šåŒæ­¥æ¨¡å¼

```yaml
performance:
  async_decisions: false  # åŒæ­¥æ¨¡å¼
```

**åæœ**:
- âŒ PyBoyçª—å£ä¼šå†»ç»“
- âŒ æ˜¾ç¤º"æœªå“åº”"
- âŒ ç”¨æˆ·ä½“éªŒå·®
- âš ï¸  ä»…ç”¨äºè°ƒè¯•

## æŠ€æœ¯ç»†èŠ‚

### çº¿ç¨‹å®‰å…¨

**AsyncDecisionMaker** ä½¿ç”¨æ ‡å‡†åº“çº¿ç¨‹å®‰å…¨ç»„ä»¶ï¼š
- `queue.Queue` - çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—
- `threading.Thread` - Pythonæ ‡å‡†çº¿ç¨‹
- æ²¡æœ‰å…±äº«çŠ¶æ€å†²çª

### æ€§èƒ½å½±å“

**CPUä½¿ç”¨**:
- å¼‚æ­¥æ¨¡å¼ï¼šç•¥å¾®å¢åŠ ï¼ˆå¤šä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼‰
- å®é™…å½±å“ï¼š<5% CPU
- æ¢æ¥ï¼šå®Œå…¨å“åº”çš„çª—å£

**å†…å­˜ä½¿ç”¨**:
- å¢åŠ ï¼šçº¦1-2MBï¼ˆçº¿ç¨‹å †æ ˆï¼‰
- å¯å¿½ç•¥ä¸è®¡

**å†³ç­–å»¶è¿Ÿ**:
- å¼‚æ­¥æ¨¡å¼ï¼šä¸åŒæ­¥å®Œå…¨ç›¸åŒ
- æ— é¢å¤–å»¶è¿Ÿ
- ä»…é˜Ÿåˆ—é€šä¿¡å¼€é”€ï¼ˆ<1msï¼‰

## ä½¿ç”¨æŒ‡å—

### é»˜è®¤é…ç½®ï¼ˆå·²å¯ç”¨æ‰€æœ‰æ”¹è¿›ï¼‰

ç›´æ¥è¿è¡Œå³å¯ï¼š
```bash
python main.py
```

ç¨‹åºä¼šæ˜¾ç¤ºï¼š
```
âœ“ Async AI decision making enabled
âœ“ Visualization dashboard available at http://localhost:5000
```

### éªŒè¯ç¨³å®šæ€§

1. **å¯åŠ¨ç¨‹åº**
   ```bash
   python main.py
   ```

2. **æ£€æŸ¥æ—¥å¿—**
   ```
   [32m13:27:13 - AsyncAI - INFO[0m - Async decision maker started
   [32m13:27:13 - Main - INFO[0m - Async AI decision making enabled
   ```

3. **è§‚å¯ŸWebä»ªè¡¨æ¿**
   - æ‰“å¼€ http://localhost:5000
   - æ¸¸æˆç”»é¢åº”è¯¥æµç•…æ›´æ–°
   - AIå†³ç­–å®æ—¶æ˜¾ç¤º

4. **æµ‹è¯•å“åº”æ€§ï¼ˆå¦‚æœheadless: falseï¼‰**
   - ç§»åŠ¨PyBoyçª—å£
   - å°è¯•æœ€å°åŒ–/æ¢å¤
   - çª—å£åº”è¯¥å§‹ç»ˆå“åº”

### æ•…éšœæ’é™¤

**é—®é¢˜1ï¼šä»ç„¶æ˜¾ç¤º"æœªå“åº”"**

è§£å†³æ–¹æ¡ˆï¼š
```yaml
game:
  headless: true  # åˆ‡æ¢åˆ°headlessæ¨¡å¼
```

**é—®é¢˜2ï¼šå¼‚æ­¥å†³ç­–å¤±è´¥**

æ£€æŸ¥æ—¥å¿—æ˜¯å¦æœ‰ï¼š
```
AsyncAI - INFO - Async decision maker started
```

å¦‚æœæ²¡æœ‰ï¼Œæ£€æŸ¥é…ç½®ï¼š
```yaml
performance:
  async_decisions: true
```

**é—®é¢˜3ï¼šWebä»ªè¡¨æ¿æ— æ³•è®¿é—®**

æ£€æŸ¥å¯è§†åŒ–æ˜¯å¦å¯ç”¨ï¼š
```yaml
visualization:
  enabled: true
```

## æ€§èƒ½å¯¹æ¯”

### æ”¹è¿›å‰

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| PyBoyå“åº”æ€§ | âŒ 6-8ç§’å†»ç»“ |
| çª—å£çŠ¶æ€ | âŒ "æœªå“åº”" |
| ç”¨æˆ·ä½“éªŒ | âŒ å·® |
| CPUä½¿ç”¨ | 30-40% |

### æ”¹è¿›åï¼ˆheadless + asyncï¼‰

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| PyBoyå“åº”æ€§ | âœ… å§‹ç»ˆå“åº” |
| çª—å£çŠ¶æ€ | âœ… æ— çª—å£ï¼ˆæˆ–æ­£å¸¸ï¼‰ |
| ç”¨æˆ·ä½“éªŒ | âœ… ä¼˜ç§€ |
| CPUä½¿ç”¨ | 25-35% |
| AIå†³ç­–é€Ÿåº¦ | âœ… ç›¸åŒ |

### æ”¹è¿›åï¼ˆheadless: false + asyncï¼‰

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| PyBoyå“åº”æ€§ | âœ… å§‹ç»ˆå“åº” |
| çª—å£çŠ¶æ€ | âœ… æ­£å¸¸ |
| ç”¨æˆ·ä½“éªŒ | âœ… è‰¯å¥½ |
| CPUä½¿ç”¨ | 35-45% |
| AIå†³ç­–é€Ÿåº¦ | âœ… ç›¸åŒ |

## æ€»ç»“

### âœ… å·²è§£å†³çš„é—®é¢˜

1. âœ… PyBoyçª—å£"æœªå“åº”"é—®é¢˜
2. âœ… ä¸»çº¿ç¨‹é˜»å¡é—®é¢˜
3. âœ… çª—å£äº‹ä»¶å¤„ç†é—®é¢˜
4. âœ… èµ„æºäº‰å¤ºé—®é¢˜

### ğŸ¯ å®æ–½çš„æ”¹è¿›

1. âœ… å¼‚æ­¥AIå†³ç­–ç³»ç»Ÿï¼ˆAsyncDecisionMakerï¼‰
2. âœ… Headlessæ¨¡å¼æ”¯æŒ
3. âœ… ä¼˜åŒ–çš„Tické¢‘ç‡
4. âœ… çµæ´»çš„é…ç½®é€‰é¡¹
5. âœ… Webä»ªè¡¨æ¿ä½œä¸ºæ›¿ä»£

### ğŸŒŸ æ¨èä½¿ç”¨æ–¹å¼

**æœ€ä½³å®è·µ**:
- ä½¿ç”¨ `headless: true`ï¼ˆæ— çª—å£ï¼‰
- ä½¿ç”¨ `async_decisions: true`ï¼ˆå¼‚æ­¥ï¼‰
- é€šè¿‡ Webä»ªè¡¨æ¿è§‚çœ‹æ¸¸æˆï¼ˆhttp://localhost:5000ï¼‰

**ä¼˜åŠ¿**:
- é›¶ç¨³å®šæ€§é—®é¢˜
- æœ€ä½³æ€§èƒ½
- æœ€ä½³ç”¨æˆ·ä½“éªŒ
- å®æ—¶å¯è§†åŒ–

### ğŸ“š ç›¸å…³æ–‡æ¡£

- Webå¯è§†åŒ–æŒ‡å—ï¼š`docs/VISUALIZATION_GUIDE.md`
- é…ç½®æ–‡ä»¶ï¼š`config.yaml`
- å¼‚æ­¥å†³ç­–æºç ï¼š`src/agents/async_decision.py`
- ä¸»ç¨‹åºé€»è¾‘ï¼š`main.py`

---

ç°åœ¨ä½ å¯ä»¥äº«å—ç¨³å®šã€æµç•…çš„Pokemon AI Agentä½“éªŒäº†ï¼ğŸ®âœ¨
